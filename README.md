## ChatRoom 数据流分析
1. 客户端请求 Nginx 的服务应用端口，在 Nginx 配置实现负载均衡可以分别将流量转发到 Proxy 集群服务统一处理请求。
2. Proxy 服务器负责解析客户端请求并调用对应的 RPC 方法，也就是把请求转发到对应提供 RPC 方法的业务集群。
3. 每个业务集群采用主从模式，主节点按照轮询的方式把请求转发到子节点上进行请求响应；我们把每个业务集群分别划分负责了不同的功能模块，主要有：用户管理集群(负责用户的登录、注销、注册)；聊天消息转发集群(在线 or 离线消息)
4. 最后每个从服务器将请求响应结果返回给主服务器，主服务器将结果返回给 Proxy 服务器，Proxy 服务器将结果转发给客户端。

## Zookeeper 

Zookeeper 主要具有的功能有：1. 数据发布/订阅; 2. 集群管理(选举); 3. 分布式管理(分布式锁、数据同步及一致性)。 Leader 选举规则： 1. Epoch 大的直接胜出； 2. Epoch 相同，事务 id 大的胜出； 3. 事务 id 相同，服务器 id 大的胜出


主服务器 Master 负责从 Zookeeper 对应的路径下查找到从节点 Follower 的 IP:Port 然后进行数据转发。从服务器一旦启动就会往 Zookeeper 中的对应路径下写入自己的 IP:Port 注册临时节点，这样一旦服务器断开连接，临时节点上的数据就会被删除。

Zookeeper 在这里其实主要就是起到一个配置中心的目的，Zookeeper 上面我们标识了每个类的方法所对应的分布式节点地址，当我们其他服务器想要发起 RPC 调用的时候，就先去 Zookeeper 上查询对应要调用的服务在那个节点上。



## Nginx
选择 Nginx 作为集群的负载均衡模块的原因有：
1. 能把 Client 的请求按照负载均衡算法分发到具体的 ProxyServer 服务器上
2. 能够与 ProxyServer 保持心跳连接机制，检查 ProxyServer 故障
3. 能够发现新添加的 ProxyServer 机器，方便扩展服务器的数量

